# Описание

OneCore - это фреймворк на движке onescript, созданный для разработки web-приложений любой сложности, используя компонентный подход.

Проект находится в активной разработке.

## Установка

Перед установкой у вас уже должна быть установлена платформа onescript версией не менее 1.8.3.

1. Скачать архив и распаковать в корень проекта, в корне проекта должен быть каталог "onecore". (временно)
2. Создать файл main.os и заполнить по примеру:

```bsl
#Использовать "onecore"

Приложение.Запустить();
```

3. Создать файл oscript.cfg со следующим содержимым:

```cfg
lib.additional=./oscript_modules
```

4. Создать файл packagedef со следующим содержимым (временно):

```bsl
Описание.Имя("onecore")
	.Версия("0.0.5")
	.ЗависитОт("json")
	.ЗависитОт("strings")
	.ЗависитОт("entity")
	.ЗависитОт("cli")
	.ЗависитОт("fs")
	.ЗависитОт("logos");
;
```

5. Выполнить консольную команду: ```opm install -l```

## Структура проекта

```md
└── Компонент                  # Каталог компонента, имя каталога соответствует имени компонента
    ├── Модели                 # Модели ORM (не реализовано)
    ├── Представления          # Представления данных, они же контроллеры
    ├── Ресурсы                # Статические данные (скрипты, картинки и т. д) (не реализовано)
    ├── Сервисы                # Произвольные сервисы, реализующие бизнес логику (не реализовано)
    ├── Шаблоны                # HTML шаблоны для шаблонизатора (не реализовано)
    └── МодульКомпонента.os    # Скрипт модуля компонента
├── main.os                    # Стартовый скрипт
├── oscript.cfg                # Конфигурационный файл onescript
└── settings.json              # Системный файл с информацией о текущей версии
```

В корне каталога проекта создаются каталоги компонентов, внутри которых реализуется логика отдельно взятого компонента. При разработке компонентов желательно соблюдать изолированность. В служебных каталогах компонента (Модели, Представления, Ресурсы, Сервисы, Шаблоны) разрешено использовать вложенные каталоги для удобной структуризации логики.

## Начало работы

Создание любого приложения на onecore начинается с создания компонента, так как компонент приложения является обособленной функциональной областью, при желании он может быть один, но не советую так поступать.

### Создание и регистрация компонента

Для создания компонента необходимо создать каталог в корне проекта и указать имя каталога в соответствии с именем планируемого компонента, например "Ядро", и создать служебные каталоги компонента (см. Структура проекта), также скрипт МодульКомпонента.os с следующим содержимым:

```bsl
Процедура ПриИнициализацииКомпонента() Экспорт
    // Код, выполняемый при инициализации приложения до его запуска
КонецПроцедуры

Процедура ПриФормированииМаршрутов(Маршруты) Экспорт
    // Код, заполняющий коллекцию маршрутов
КонецПроцедуры
```

Для того, чтобы приложение использовало созданный компонент, его необходимо проинициализировать перед запуском приложения в файле main.os:

```bsl
#Использовать "onecore"

МенеджерКомпонентов = Приложение.МенеджерКомпонентов();
МенеджерКомпонентов.Инициализировать("Ядро", "core");

Приложение.Запустить();
```

При выполнении процедуры "Инициализировать" класса "МенеджерКомпонентов", будет вызвана процедура "ПриИнициализацииКомпонента" модуля компонента, в данной процедуре можно выполнять любые действия, например объявить настройки приложения для файла settings.json.

### Маршрутизация и создание представления (контроллера)

Для того, чтобы ваше приложение принимало запросы, необходимо создать контроллер, контроллеры в onecore называются представлениями, так как они обязаны формировать ответ, в котором данные могут быть представлены в разном формате, например как html, или внешний api для интеграции и т. д.

Для того, чтобы создать контроллер, необходимо в каталоге "Представления" вашего компонента создать скрипт и назвать его так, как далее вы хотите его использовать, например "Приветствие.os" и обязательно заполнить его по шаблону:

```bsl
Перем Запрос;
Перем Ответ;
Перем Контекст; // Не реализован, пока можно не объявлять

Процедура GET() Экспорт
    // Код обработчика запроса
КонецПроцедуры
```

Процедуры обработчиков запросов должны обязательно называться в соответствии с методами HTTP, которые необходимо обработать (GET, POST, PUT, DELETE, HEAD, CONNECT, OPTIONS, PATCH, TRACE), маршрутизатор самостоятельно запустит выполнение нужной процедуры в зависимости от метода поступившего запроса.

Для тестирования сразу напишем код обработчика:

```bsl
Процедура GET() Экспорт
    Ответ.УстановитьТипСодержимого("html");
    Ответ.УстановитьТелоКакСтроку("<h1>Привет мир!!! Как банально...</h1>");
КонецПроцедуры
```

На данный момент мы имеем объект контроллера, но не понятно, как приложение будет понимать, что запрос адресован именно ему, для этого существует маршрутизация, и указать соответствие адреса с обработчиком мы должны в том же модуле компонента в процедуре "ПриФормированииМаршрутов":

```bsl
Процедура ПриФормированииМаршрутов(Маршруты) Экспорт
    Маршруты.Добавить("/", "Приветствие");
КонецПроцедуры
```

Согласно тому, что мы указали, сервер, при обращении клиента к корневому адресу, будет переадресовывать выполнение в наш контроллер. Процедура "Добавить" принимает в себя 2 параметра, первый - это шаблон адреса (временно шаблоны адресов не поддерживаются, только прямой адрес) второй - это строковый путь к объекту обработчика запроса через точку, при этом, если бы у нас объект обработчика находился не в корневом каталоге "Представления", а например в каталоге "Тестирование", тогда указание маршрута выглядило бы так ```Маршруты.Добавить("/", "Тестирование.Приветствие");```.

Теперь приложение понимает, куда адресовать запросы.

### Запуск и отладка

Для запуска приложения достаточно выполнить команду ```oscript main.os```, и перейти по адресу, указанному в консоли. Второй вариант - это настроить отладку, для этого нужно создать файл отладки по инструкции платформы onescript и указать следующее содержимое:

```json
{
    // Используйте IntelliSense, чтобы узнать о возможных атрибутах.
    // Наведите указатель мыши, чтобы просмотреть описания существующих атрибутов.
    // Для получения дополнительной информации посетите: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Приложение",
            "type": "oscript",
            "request": "launch",
            "program": "${workspaceRoot}\/main.os",
            "args": [],
            "cwd": "${workspaceRoot}",
            "env": {},
            "runtimeExecutable": null,
            "runtimeArgs": [],
            "debugPort": 2801
        }
    ]
}
```

Далее запускаем отладку привычным нам способом.
